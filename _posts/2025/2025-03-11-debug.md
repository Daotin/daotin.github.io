---
layout: mypost
title: VSCode DebugæŠ€å·§
tags: [å‰ç«¯]
---

1. ç›®å½•
{:toc}

## è°ƒè¯•ç½‘é¡µ

### é…ç½®è¯¦è§£

```json
{
  "name": "vscodeè°ƒè¯•",

  // launchï¼šlaunch çš„æ„æ€æ˜¯æŠŠ url å¯¹åº”çš„ç½‘é¡µè·‘èµ·æ¥ï¼ŒæŒ‡å®šè°ƒè¯•ç«¯å£ï¼Œç„¶åé¡µé¢ä¼šè‡ªåŠ¨attachåˆ°è¿™ä¸ªç«¯å£ã€‚
  // attachï¼šå¦‚æœä½ å·²ç»æœ‰ä¸€ä¸ªåœ¨è°ƒè¯•æ¨¡å¼è·‘çš„æµè§ˆå™¨äº†ï¼Œé‚£ç›´æ¥ attachä¸Šå°±è¡Œ
  "request": "launch",

  // æµè§ˆå™¨
  "type": "chrome",

  "runtimeArgs": [
    "--auto-open-devtools-for-tabs" // æ‰“å¼€ç½‘é¡µéƒ½é»˜è®¤è°ƒèµ· Chrome DevTools
    "--incognito" // æ— ç—•æ¨¡å¼
  ],

  // "canary"ã€"stable"ã€"custom" æˆ–æµè§ˆå™¨å¯æ‰§è¡Œæ–‡ä»¶çš„è·¯å¾„ã€‚ Custom è¡¨ç¤ºè‡ªå®šä¹‰åŒ…è£…å™¨ã€è‡ªå®šä¹‰ç”Ÿæˆæˆ– CHROME_PATH ç¯å¢ƒå˜é‡ã€‚
  "runtimeExecutable": "canary",

  // userDataDir æ˜¯ä¿å­˜ç”¨æˆ·æ•°æ®çš„åœ°æ–¹ï¼Œæ¯”å¦‚ä½ çš„æµè§ˆè®°å½•ã€cookiesã€æ’ä»¶ã€ä¹¦ç­¾ã€ç½‘ç«™çš„æ•°æ®ç­‰ç­‰
  // é»˜è®¤æ˜¯ trueï¼Œä»£è¡¨åˆ›å»ºä¸€ä¸ªä¸´æ—¶ç›®å½•æ¥ä¿å­˜ç”¨æˆ·æ•°æ®ã€‚
  // è®¾ç½®ä¸ºfalseï¼Œå¯ä»¥è®°å½•ç™»å½•çŠ¶æ€ã€å†å²è®°å½•
  // ä¹Ÿå¯ä»¥æŒ‡å®šä¸€ä¸ªè‡ªå®šä¹‰çš„è·¯å¾„ï¼Œè¿™æ ·ç”¨æˆ·æ•°æ®å°±ä¼šä¿å­˜åœ¨é‚£ä¸ªç›®å½•ä¸‹
  // æ³¨æ„ï¼šuserDataDir åªèƒ½è·‘ä¸€ä¸ª Chrome å®ä¾‹ï¼Œæ‰€ä»¥æˆ‘ä½¿ç”¨chromeè°ƒè¯•ï¼Œedgeç”¨ä½œå…¶ä»–æœç´¢
  "userDataDir": false,

  "url": "<http://localhost:8080>",

  // workspaceFolder: æŠŠ / çš„ url æ˜ å°„åˆ°äº† ${workspaceFoder} é¡¹ç›®æ ¹ç›®å½•
  "webRoot": "${workspaceFolder}",

  // æ˜¯å¦å…³é—­sourcemapæ˜ å°„
  "sourceMaps": false,

  // é™¤äº†å¯åŠ¨å¼€å‘æœåŠ¡å™¨ç„¶åè¿ä¸Š url è°ƒè¯•ä¹‹å¤–ï¼Œä¹Ÿå¯ä»¥ç›´æ¥æŒ‡å®šæŸä¸ªæ–‡ä»¶ï¼ŒVSCode Debugger ä¼šå¯åŠ¨é™æ€æœåŠ¡å™¨æä¾›æœåŠ¡
  "file": "$workspaceFolder}/index.html"

  // sourcemapé‡æ˜ å°„ï¼šæœ‰æ—¶å€™ï¼Œsourcemap åˆ°çš„æ–‡ä»¶è·¯å¾„åœ¨æœ¬åœ°é‡Œæ‰¾ä¸åˆ°ï¼Œä»£ç å°±æ˜¯åªè¯»çš„ï¼Œè¿™æ—¶å€™å°±éœ€è¦å†æ¬¡æ‰‹åŠ¨æ˜ å°„åˆ°æœ¬åœ°æ–‡ä»¶
  // ä»¥ä¸‹æ˜¯ï¼šé»˜è®¤æœ‰ä¸‰ä¸ªå€¼ï¼Œåˆ†åˆ«æ˜¯æŠŠ meteorã€webpack å¼€å¤´çš„ path æ˜ å°„åˆ°äº†æœ¬åœ°çš„ç›®å½•ä¸‹ã€‚
  // å…¶ä¸­ ?:* ä»£è¡¨åŒ¹é…ä»»æ„å­—ç¬¦ï¼Œä½†ä¸æ˜ å°„ï¼Œè€Œ * æ˜¯ç”¨äºåŒ¹é…å­—ç¬¦å¹¶æ˜ å°„çš„ã€‚
  // ä¸¾ä¾‹ï¼šæœ€åä¸€ä¸ª webpack://?:/ åˆ° ${workspaceFolder}/* çš„æ˜ å°„ï¼Œå°±æ˜¯æŠŠ webpack:// å¼€å¤´ï¼Œåé¢æ¥ä»»æ„å­—ç¬¦ + / ç„¶åæ˜¯ä»»æ„å­—ç¬¦çš„è·¯å¾„æ˜ å°„åˆ°äº†æœ¬åœ°çš„é¡¹ç›®ç›®å½•
  "sourceMapPathOverrides": {
    "meteor://ğŸ’»app/*": "${workspaceFolder}/*",
    "webpack:///./~/*": "${workspaceFolder}/node_modules/*",
    "webpack://?:*/*": "${workspaceFolder}/*"
  }
}

```

å¸¸ç”¨é…ç½®ï¼š

```json
{
  "name": "vscodeè°ƒè¯•",
  "request": "launch",
  "type": "chrome",
  "runtimeArgs": ["--auto-open-devtools-for-tabs"],
  "runtimeExecutable": "canary",
  "userDataDir": false,
  "url": "<http://localhost:8080>",
  "webRoot": "${workspaceFolder}"
}

```

### è°ƒè¯• Vue é¡¹ç›®

å¯åŠ¨åï¼Œå…ˆæ‰“ä¸ªæ–­ç‚¹å‘ç°ä¸èµ·æ•ˆï¼Œåˆ†ææ˜¯è·¯å¾„ä¸å¯¹ã€‚

æ€ä¹ˆæ‰¾è·¯å¾„ï¼Ÿ

å…ˆåœ¨ä»£ç é‡Œé¢å†™ `debugger`ï¼Œè¿›å…¥è°ƒè¯•çª—å£ï¼ŒæŸ¥çœ‹ç›®å‰çš„çŠ¶å†µã€‚

- å‘ç°ä»–ä»ä¸€ä¸ªä¹±ä¸ƒå…«ç³Ÿçš„è·¯å¾„ï¼Œæ˜ å°„åˆ°äº† webpack://vue-demo1/src/App.vue?11c4 çš„è·¯å¾„ä¸‹ã€‚
- ç„¶ååœ¨ VSCode Debugger é‡Œçœ‹çœ‹è¿™ä¸ªè·¯å¾„ï¼Œå‘ç°æ˜¯ /Users/guang/code/vue-demo1/src/App.vue?11c4
- å…¶å®è¿™ä¸ªè·¯å¾„å·²ç»åšè¿‡äº†æ˜ å°„ï¼Œå°±æ˜¯å®Œæˆäº†ä» webpack:///vue-demo1/src/App.vue?11c4 åˆ° /Users/guang/code/vue-demo1/src/App.vue?11c4 çš„æ˜ å°„ã€‚ï¼ˆä½¿ç”¨çš„ sourceMapPathOverrides çš„ç¬¬ä¸‰æ¡é…ç½®ï¼‰

ä½†é—®é¢˜å°±å‡ºç°åœ¨åé¢å¤šäº†ä¸€ä¸ª ?hash çš„å­—ç¬¦ä¸²ï¼Œå¯¼è‡´è·¯å¾„ä¸å¯¹äº†ã€‚æ‰€ä»¥åœ¨æˆ‘ä»¬ vue ä»£ç é‡Œé¢æ‰“æ–­ç‚¹ä¼šæ˜¾ç¤ºæœªå…³è”ï¼Œå› ä¸ºå¯¹åº”çš„æœ¬åœ°æ–‡ä»¶æ²¡æœ‰ã€‚

é‚£ä¸ºä»€ä¹ˆä¼šå¤šè¿™æ ·ä¸€ä¸ª hash å‘¢ï¼Ÿ

è¿™æ˜¯å› ä¸º vue cli é»˜è®¤çš„ devtool è®¾ç½®æ˜¯ `eval-cheap-module-source-map`ï¼ŒsourceURL çš„è·¯å¾„æ˜¯é€šè¿‡ [module] æŒ‡å®šçš„ï¼Œè€Œæ¨¡å—ååé»˜è®¤ä¼šå¸¦ ?hashã€‚

è§£å†³åŠæ³•å°±æ˜¯ï¼šä» eval-cheap-module-source-map å˜ä¸º source-mapã€‚

- å»æ‰ moduleï¼ˆæœ€å webpack çš„é…ç½®ä¸ºï¼š`config.devtool = "source-map"`ï¼‰
    
    ```jsx
    configureWebpack(config) { 
      config.devtool = "source-map";
    }
    ```
    
- æ·»åŠ é…ç½®ï¼ˆå…·ä½“å¯ä»¥æ‰“æ–­ç‚¹åœ¨è°ƒè¯•ç•Œé¢çœ‹è·¯å¾„ï¼‰
    
    ```json
    "sourceMapPathOverrides": {
      "webpack:///src/*": "${workspaceFolder}/src/*"
    }
    
    ```
    

## è°ƒè¯•æºç 

### è°ƒè¯• vue æºç 

1ã€ä¸‹è½½ vue æºç 

```
git clone <https://github.com/vuejs/core> vue3-core

```

2ã€ä½¿ç”¨ pnpm å®‰è£…

> PSï¼šæ³¨æ„å»æ‰ package.json ä¸­çš„ puppeteerï¼Œç”¨æ¥åšé›†æˆæµ‹è¯•çš„ï¼Œä¸€æ˜¯ç”¨ä¸åˆ°ï¼ŒäºŒæ˜¯ç½‘ç»œé—®é¢˜ä¸å»æ‰ä¸€ç›´å®‰è£…å¤±è´¥ã€‚
> 

```
pnpm install

```

3ã€ç”Ÿæˆ sourcemap

- æ–¹å¼ä¸€ï¼šç›´æ¥ `pnpm run build --sourcemap` æ‰“åŒ…å³å¯
- æ–¹å¼äºŒï¼šç”±äºåœ¨ rollup.config.js çœ‹åˆ° `output.sourcemap = !!process.env.SOURCE_MAP` ï¼Œæƒ³è¦ç”Ÿæˆ sourcemapï¼Œéœ€è¦ SOURCE_MAP ç¯å¢ƒå˜é‡ä¸º trueã€‚
- å®‰è£… cross-env

```
pnpm add cross-env

```

- è®¾ç½® `"build": "cross-env SOURCE_MAP=true node scripts/build.js"`
- ä½¿ç”¨ `pnpm run build`æ‰“åŒ…

ç„¶åå» packages ä¸‹å„ä¸ªåŒ…ä¸‹çš„ dist äº§ç‰©ï¼Œä½ å°±ä¼šå‘ç°æœ‰ sourcemap äº†ã€‚

4ã€æŠŠ `runtime-core` åŒ…ä¸‹çš„ dist å¤åˆ¶å‡ºæ¥ï¼Œæ›¿æ¢ vue é¡¹ç›®çš„ `@vue/runtime-core` ä¸‹çš„ å¯¹åº”çš„ dist ç›®å½•ã€‚

æ³¨æ„æ˜¯æ›¿æ¢è€Œä¸æ˜¯åˆ äº†æ•´ä¸ª distï¼Œå› ä¸ºè¿˜æœ‰ä¸€ä¸ªæ–‡ä»¶æ˜¯éœ€è¦çš„ã€‚

![image](https://github.com/user-attachments/assets/6809ded2-6bb0-4442-b9f4-38328300d73b)


> æ³¨æ„ 1ï¼švue æºç çš„ç‰ˆæœ¬ä¸€å®šè¦å’Œ vue é¡¹ç›®ä¸­ä½¿ç”¨çš„ vue ç‰ˆæœ¬ç›¸åŒï¼Œå¦åˆ™å¯åŠ¨ä¼šæŠ¥é”™ï¼
> 
> 
> æ³¨æ„ 2ï¼šä½¿ç”¨ vite æ­å»ºçš„ vue é¡¹ç›®æ²¡æœ‰ç”Ÿæ•ˆã€‚åŸå› ï¼švite æ²¡æœ‰ source-map-loader è¿™äº›ä¸œè¥¿ï¼Œæ— æ³•è¯»å– node_modules ä¸‹æ¨¡å—çš„ sourcemapã€‚è§£å†³åŠæ³•ï¼šä¸€æ˜¯è°ƒè¯•æºç å°±ç”¨ webpack çš„ vue3 é¡¹ç›®ã€‚äºŒæ˜¯æŠŠ vite ä¸­é…ç½® `optimizeDeps: { exclude: ["vue"], }` æ’é™¤ä¸€ä¸‹ depsï¼Œç„¶ååˆ é™¤ node_modules ä¸‹ `.Vite`æ–‡ä»¶å¤¹ã€‚
> 
> æ³¨æ„ 3ï¼šå¦‚æœæ— æ³•æ‰“æ–­ç‚¹ï¼Œå°±æŠŠ vue é¡¹ç›®é‡æ–°å®‰è£…è·‘ä¸€ä¸‹ã€‚ã€‚ã€‚
> 

![image](https://github.com/user-attachments/assets/6ac5dbe5-cc85-4c83-885f-ace6123633a3)


æŒ‰ç…§æµç¨‹è·‘èµ·æ¥åï¼Œç¡®å®é“¾æ¥çš„æ˜¯æœ¬åœ°è·¯å¾„ï¼Œä¸è¿‡ç°åœ¨ sourcemap åˆ°çš„è·¯å¾„ä¸å¤§å¯¹ï¼Œæ²¡æœ‰ runtime-core çš„åŒ…åï¼Œä¸èƒ½ç¼–è¾‘ï¼š

è§£å†³æ–¹å¼æœ‰ 2 ç§ï¼š

1. ä¸€ç§æ˜¯é…ç½®ä¸‹ sourceMapPathOverridesï¼ŒæŠŠè¿™æ®µè·¯å¾„å†åšä¸€æ¬¡æ˜ å°„ï¼Œæ˜ å°„åˆ°æºç ç›®å½•å°±å¯ä»¥äº†ã€‚
2. å¦ä¸€ç§æ–¹å¼å°±æ˜¯æ”¹é€ ä¸‹ vue3 çš„ build è„šæœ¬ï¼Œè®©ç”Ÿæˆçš„ sourcemap å°±ç›´æ¥æ˜¯æ­£ç¡®çš„è·¯å¾„ã€‚

ä½†æ˜¯ç¬¬ä¸€ç§çš„è¯ä¸å¤ªå¥½æ‰¾ï¼Œæ‰€ä»¥é‡‡ç”¨ç¬¬äºŒç§ã€‚

```
// output.sourcemap = !!process.env.SOURCE_MAP
output.sourcemapPathTransform = (relativeSourcePath, sourcemapPath) => {
  const newSourcePath = path.join(
    path.dirname(sourcemapPath),
    relativeSourcePath
  );
  return newSourcePath;
};

```

é‡æ–° build ä¸€ä¸‹ï¼Œç„¶åè¿›è¡Œ dist å¤åˆ¶ã€‚

> æ³¨æ„ï¼šå¯¹äº webpack çš„é¡¹ç›®ï¼Œè¿™é‡Œè¿˜éœ€è¦æ¸…é™¤ä¸€ä¸‹ babel loader çš„ç¼“å­˜ï¼Œåˆ é™¤ node_modules/.cache/babel-loader å³å¯ã€‚
> 

### è°ƒè¯• vite æºç 

- åˆ›å»º .vscode/launch.json çš„é…ç½®æ–‡ä»¶ï¼Œæ·»åŠ ä¸€ä¸ª npm ç±»å‹çš„è°ƒè¯•é…ç½®
- runtimeArgsé…ç½®ä¸ºdev
- åœ¨vite.config.js æ‰“ä¸ªæ–­ç‚¹ï¼Œå¾€ä¸‹æ‰§è¡Œä¸€æ­¥ï¼Œå°±è¿›å…¥åˆ° vite æºç äº†ï¼Œè¿™å°±æ˜¯è¯»å–é…ç½®çš„ç›¸å…³ä»£ç ã€‚ä½†æ˜¯ç°åœ¨çš„ä»£ç æ˜¯è¢«ç¼–è¯‘è¿‡çš„ï¼Œå¯è¯»æ€§å¾ˆå·®ã€‚æ‰€ä»¥æˆ‘ä»¬è¦é€šè¿‡ sourcemap æ¥æŠŠå®ƒæ˜ å°„åˆ°æºç å†è°ƒè¯•ã€‚
- ä» github æŠŠ vite ä¸‹è½½ä¸‹æ¥
- å®‰è£…ä¾èµ–ï¼Œç„¶åæ‰§è¡Œ npm run build --watch
- æŠŠè¿™ä¸ª dist ç›®å½•å¤åˆ¶åˆ°æµ‹è¯•é¡¹ç›®çš„ node_modules/vite ä¸‹ï¼Œè¦†ç›–åŸæ¥çš„ dist
- ä½ ä¼šå‘ç°è°ƒè¯•è¿˜æ˜¯ç¼–è¯‘åçš„æºç ã€‚å› ä¸ºé»˜è®¤ VSCode Node Debugger ä¼šå¿½ç•¥ node_modules ä¸‹çš„ sourcemap
- resolveSourceMapLocations æ˜¯é…ç½®å»é‚£é‡Œæ‰¾ sourcemap çš„ï¼Œé»˜è®¤æŠŠ node_modules æ’é™¤äº†ã€‚å»æ‰é‚£è¡Œé…ç½®å³å¯ã€‚
- å†æ¬¡è°ƒè¯•ï¼Œä½ å°±ä¼šå‘ç°è°ƒè¯•çš„æ˜¯ vite çš„ ts æºç äº†ï¼

### è°ƒè¯• ElementUI æºç 

ä¸€ã€é¦–å…ˆå®šä½ ElementUI æºç 

**1ã€å¯ä»¥é€šè¿‡äº‹ä»¶æ–­ç‚¹çš„æ–¹å¼ï¼Œæ…¢æ…¢è¿›å…¥ç»„ä»¶çš„æºç ã€‚**

- ä½†æ˜¯ç»„ä»¶çš„ä»£ç æ˜¯è¢«ç¼–è¯‘æ‰“åŒ…è¿‡çš„ï¼Œä¸æ˜¯æœ€åˆçš„æºç ã€‚
- ä¸ºäº†è°ƒè¯•æœ€åˆçš„æºç ï¼Œéœ€è¦ä¸‹è½½äº† Element UI çš„ä»£ç ï¼Œbuild å‡ºäº†ä¸€ä»½å¸¦æœ‰ sourcemap çš„ä»£ç ã€‚è¦†ç›–é¡¹ç›® node_modules ä¸‹çš„ä»£ç ï¼Œé‡æ–°è·‘ dev serverï¼Œè¿™æ—¶å€™å°±å¯ä»¥ç›´æ¥è°ƒè¯•ç»„ä»¶æºç äº†ã€‚

**2ã€å½“æœ‰äº† sourcemap ä¹‹åï¼ŒChrome DevTools ä¼šç›´æ¥æŠŠ vue æ–‡ä»¶åˆ—åœ¨ sources é‡Œï¼Œæˆ‘ä»¬å¯ä»¥æ‰¾åˆ°å¯¹åº”çš„ vue æ–‡ä»¶æ¥æ‰“æ–­ç‚¹ï¼Œå°±ä¸ç”¨é€šè¿‡äº‹ä»¶æ–­ç‚¹æ¥æ‰¾äº†ã€‚**

èƒ½å¤Ÿè°ƒè¯• Element UI æºç ä¹‹åï¼Œæƒ³çŸ¥é“ç»„ä»¶å†…éƒ¨éƒ½æœ‰å“ªäº›é€»è¾‘çš„è¯ï¼Œå°±å¯ä»¥ç›´æ¥åœ¨æºç æ–­ç‚¹è°ƒè¯•äº†ã€‚

### æ–­ç‚¹æ˜¯å¦‚ä½•åœ¨ç½‘é¡µé‡Œç”Ÿæ•ˆçš„

æ¯”å¦‚æºä»£ç çš„è·¯å¾„æ˜¯ /Users/xxx/vite-demo/src/App.vue ï¼Œæœ€åæ‰“åŒ…åè¿è¡Œå¯èƒ½æ˜¯http://xxx.com/bundle.jsã€‚

ç”±äºæ–‡ä»¶æ˜¯å…³è”äº† sourcemap çš„ï¼Œæ‰€ä»¥å°±ç›´æ¥æ˜ å°„åˆ°äº†/Users/xxx/vite-demo/src/App.vue æ–‡ä»¶ï¼Œè€Œ App.vue ä¸­æ‰“çš„æ–­ç‚¹å°±æ˜¯é€šè¿‡ CDP è°ƒè¯•åè®®è¿›è¡Œé€šä¿¡çš„ã€‚

![image](https://github.com/user-attachments/assets/280784f8-41e1-44d2-b658-ad53c8712cc9)

### æ‰“æ–­ç‚¹çš„ 7 ç§æ–¹å¼

- å¼‚å¸¸æ–­ç‚¹ï¼ˆUncaught Exceptionsï¼‰ï¼šåœ¨æŠ›å¼‚å¸¸å¤„æ–­ä½
- æ¡ä»¶æ–­ç‚¹ï¼ˆconditional breakpointï¼‰ï¼šåœ¨æ»¡è¶³æŸä¸ªè¡¨è¾¾å¼çš„æ—¶å€™æ–­ä½
- æ—¥å¿—ç‚¹ï¼ˆlogpointï¼‰ï¼šæ‰“å°æ—¥å¿—ä½†ä¸æ–­ä½ï¼Œè§‰å¾—æ–­ä½å¤ªå¤šæ¬¡çš„æ—¶å€™å¯ä»¥ç”¨è¿™ä¸ª
- DOM æ–­ç‚¹ï¼šåœ¨ DOM å­æ ‘ä¿®æ”¹ã€å±æ€§ä¿®æ”¹ã€èŠ‚ç‚¹åˆ é™¤çš„æ—¶å€™æ–­ä½
    
![image](https://github.com/user-attachments/assets/adca5c97-bd2a-43f5-a750-cdf802926735)
    
- Event Listenter æ–­ç‚¹ï¼šåœ¨æŸä¸ªäº‹ä»¶å‘ç”Ÿçš„æ—¶å€™æ–­ä½
- url è¯·æ±‚æ–­ç‚¹ï¼šåœ¨å‘é€ url åŒ…å«æŸå†…å®¹çš„è¯·æ±‚æ—¶æ–­ä½
    
![image](https://github.com/user-attachments/assets/0c08fa4c-e02c-464a-83f8-b21b4004e5d7)
    

---

- sourcemap çš„åŸç†å’Œä½œç”¨
    - webpack çš„ sourcemap é…ç½®
    - è°ƒè¯• Reactã€Vue æºç 
- Node.js çš„è°ƒè¯•
    - VSCode Node Debugger é…ç½®
    - è°ƒè¯• Nest.js æºç 
    - å‘½ä»¤è¡Œå·¥å…·çš„ä¸¤ç§è°ƒè¯•
        - è°ƒè¯•ä¸‹ ESLintã€Babelã€TypeScript çš„æºç 
- Chrome DevTools
    - 6 ç§æ‰“æ–­ç‚¹çš„æ–¹å¼
    - Performance :åˆ†æå’Œä¼˜åŒ–ç½‘é¡µæ€§èƒ½
    - LightHouse :æ£€æµ‹é¡µé¢æ€§èƒ½
    - Memoryï¼šåˆ†æå†…å­˜é—®é¢˜
- è°ƒè¯•ç§»åŠ¨ç«¯ç½‘é¡µ
    - è°ƒè¯•å®‰å“å’Œ ios çš„ç½‘é¡µ
    - Charles çš„ä½¿ç”¨
- è°ƒè¯•å·¥å…·çš„åŸç†
    - è‡ªå®šä¹‰è°ƒè¯•å·¥å…·çš„å®ç°åŸç†
        - å®ç°ä¸€ä¸ªç®€æ˜“ç‰ˆ React DevTools
    - Chrome DevTools çš„åŸç†
        - å®ç° mini puppeteer
        - åˆ†åˆ«å®ç° Chrome DevTools çš„å„ä¸ªéƒ¨åˆ†çš„åŠŸèƒ½

## è°ƒè¯• Node.js

### ä½¿ç”¨vscode launchæ–¹å¼

1ã€æ·»åŠ ä¸€ä¸ª node ç±»å‹çš„ launch program çš„è°ƒè¯•é…ç½®ï¼ŒæŒ‡å®š program çš„è·¯å¾„

2ã€ä½ ä¹Ÿæƒ³é¦–è¡Œæ–­ä½ï¼Œå¯ä»¥åŠ ä¸€ä¸ª stopOnEntry çš„é…ç½®ï¼š

3ã€å¯ä»¥é€šè¿‡ args æ¥æ·»åŠ å‘½ä»¤è¡Œå‚æ•°ï¼š

### ä½¿ç”¨vscode attachæ–¹å¼

1ã€ä»¥è°ƒè¯•æ¨¡å¼å¯åŠ¨node

```jsx
// --inspect æ˜¯ä»¥è°ƒè¯•æ¨¡å¼å¯åŠ¨ï¼Œ--inspect-brk æ˜¯ä»¥è°ƒè¯•æ¨¡å¼å¯åŠ¨å¹¶ä¸”åœ¨é¦–è¡Œæ–­ä½ã€‚
node --inspect-brk ./index.js
```

2ã€æ·»åŠ ä¸€ä¸ª node ç±»å‹çš„ attach çš„è°ƒè¯•é…ç½®ï¼Œç«¯å£æ”¹æˆ ws æœåŠ¡å¯åŠ¨çš„ç«¯å£ 8888

3ã€ç„¶åç‚¹å‡» debug å¯åŠ¨

### ä½¿ç”¨ Chrome DevTools è°ƒè¯• node ä»£ç 

æ‰“å¼€Â [chrome://inspect/#devices](https://link.juejin.cn/?target=)ï¼Œä¸‹é¢åˆ—å‡ºçš„æ˜¯æ‰€æœ‰å¯ä»¥è°ƒè¯•çš„ç›®æ ‡ï¼Œä¹Ÿå°±æ˜¯ ws æœåŠ¡ç«¯ï¼š

ä½ ä¼šå‘ç°è¿™é‡Œåˆ—å‡ºäº†æˆ‘ä»¬å¯åŠ¨çš„è·‘çš„é‚£ä¸ª node è„šæœ¬ã€‚ç‚¹å‡» inspect å°±å¯ä»¥è°ƒè¯•è¿™ä¸ª node è„šæœ¬äº†ã€‚

### VSCode Node Debugger é…ç½®

- **attach**
- restartï¼šVSCode Debugger ä»¥ attach çš„æ–¹å¼å¯åŠ¨ï¼Œæ˜¯éœ€è¦è¿æ¥ ws è°ƒè¯•æœåŠ¡çš„ï¼Œè€Œè¿æ¥è‡ªç„¶å°±å¯èƒ½è¶…æ—¶ã€å¤±è´¥ä¹‹ç±»çš„ï¼Œè¿™æ—¶å€™å°±éœ€è¦é‡è¿ã€‚é‡è¿çš„é—´éš”å’Œæ¬¡æ•°æ˜¯å¯ä»¥é…ç½®çš„ï¼š
    
![image](https://github.com/user-attachments/assets/b632c622-8d32-41ad-b473-efbc8b9bd40e)
    
- launch
- argsï¼šæ·»åŠ å‘½ä»¤è¡Œå‚æ•°
    
![image](https://github.com/user-attachments/assets/46576b5a-1c43-4fa2-9c08-ba81b0398e39)
    
![image](https://github.com/user-attachments/assets/67142700-fa59-497d-9b0d-5a6c8750e9bb)
    
- **runtimeExecutableï¼šruntime é»˜è®¤æ˜¯ nodeï¼Œå…¶å®è¿™ä¸ªä¹Ÿæ˜¯å¯ä»¥æ”¹çš„ï¼ŒVSCode Debugger ä¼šä» PATH çš„ç¯å¢ƒå˜é‡ä¸­æŸ¥æ‰¾å¯¹åº”åå­—çš„ runtime å¯åŠ¨ã€‚æ¯”å¦‚è°ƒè¯• npm scriptsï¼Œå°±ä¼šæ”¹æˆnpm**
    - runtimeArgsï¼šç±»ä¼¼argsï¼Œç»™**runtime ä¼ å‚æ•°ï¼Œæ¯”å¦‚ npm run start**
- skipFiles: é»˜è®¤è·³è¿‡çš„æ–‡ä»¶ï¼Œè¿™æ ·å°±å¯ä»¥ç²¾ç®€æ‰è°ƒç”¨æ ˆï¼Œåªæ˜¾ç¤ºæˆ‘ä»¬å…³å¿ƒçš„éƒ¨åˆ†ã€‚é»˜è®¤å€¼æ˜¯ `<node_internal>/**`
- **stopOnEntryï¼šæ˜¯å¦åœ¨é¦–è¡Œæ–­ä½**
- **consoleï¼šé»˜è®¤ debug æ¨¡å¼ä¸‹ï¼Œæ‰“å°çš„æ—¥å¿—æ˜¯åœ¨ console çš„ï¼Œè€Œä¸æ˜¯ terminalã€‚è€Œ console é‡Œæ˜¯ä¸æ”¯æŒå½©è‰²çš„ï¼Œè¿™ä¸ªå¯ä»¥é€šè¿‡ console é…ç½®è®¾ç½®**
    - internalConsole å°±æ˜¯å†…ç½®çš„ debug console é¢æ¿ï¼Œé»˜è®¤æ˜¯è¿™ä¸ª
    - internalTerminal æ˜¯å†…ç½®çš„ terminal é¢æ¿ï¼Œåˆ‡æ¢æˆè¿™ä¸ªå°±æ˜¯å½©è‰²äº†
    - externalTerminal ä¼šæ‰“å¼€ç³»ç»Ÿçš„ terminal æ¥å±•ç¤ºæ—¥å¿—ä¿¡æ¯
- autoAttachChildProcessesï¼š
- cwdï¼šå½“å‰å·¥ä½œç›®å½•ï¼ŒæŒ‡å®š runtime åœ¨å“ªä¸ªç›®å½•è¿è¡Œï¼Œé»˜è®¤æ˜¯é¡¹ç›®æ ¹ç›®å½• workspaceFolder
- **envï¼šè®¾ç½®ç¯å¢ƒå˜é‡**
- **presentationï¼šé…ç½®çš„åˆ†ç»„è¿˜æœ‰æ’åº**

## è°ƒè¯• npm scripts

è¿™äº›å‘½ä»¤è¡Œå·¥å…·çš„ package.json é‡Œéƒ½ä¼šæœ‰ä¸ª bin å­—æ®µï¼Œæ¥å£°æ˜æœ‰å“ªäº›å‘½ä»¤ï¼Œnpm install è¿™ä¸ªåŒ…ä»¥åï¼Œå°±ä¼šæ”¾åˆ° node_modules/.bin ç›®å½•ä¸‹ã€‚

è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ node ./node_modules/.bin/xx æ¥è·‘ä¸åŒçš„å·¥å…·äº†ã€‚ä¸ä½¿ç”¨ npm run xxx ä¸€æ ·ã€‚

1ã€åœ¨ .vscode/launch.json çš„è°ƒè¯•æ–‡ä»¶é‡Œï¼Œé€‰æ‹© node çš„ launch programï¼šç”¨ node æ‰§è¡Œ node_modules/.bin ä¸‹çš„æ–‡ä»¶ï¼Œä¼ å…¥å‚æ•°å³å¯

![image](https://github.com/user-attachments/assets/8e6b5037-e513-4157-9aec-bdb337b5cf4a)

2ã€VSCode Debugger å¯¹ npm scripts è°ƒè¯•çš„åœºæ™¯åšäº†å°è£…ï¼Œå¯ä»¥ç›´æ¥é€‰æ‹© npm ç±»å‹çš„è°ƒè¯•é…ç½®ï¼Œç›´æ¥æŒ‡å®šè¿è¡Œçš„å‘½ä»¤å³å¯

![image](https://github.com/user-attachments/assets/3432819d-f84a-454e-886c-ffde3844c3f4)

ç„¶åï¼Œæˆ‘ä»¬å°±å¯ä»¥ node_modules/.bin ä¸‹è¿™ä¸ªæ–‡ä»¶é‡Œæ‰“ä¸ªæ–­ç‚¹ï¼Œæˆ–è€…æƒ³è¦æŸ¥çœ‹é»˜è®¤webpacké…ç½®ï¼Œå¯ä»¥åœ¨vue.config.jsä¸­æ‰“ä¸ªæ–­ç‚¹è¿›è¡Œè°ƒè¯•ã€‚

é»˜è®¤è°ƒè¯•æ¨¡å¼ä¸‹ï¼Œè¾“å‡ºçš„å†…å®¹ä¼šåœ¨ Debug Console é¢æ¿æ˜¾ç¤ºï¼šä½†è¿™ä¸ªä¹Ÿå¯ä»¥æ”¹ï¼šå¯ä»¥åˆ‡æ¢æˆ integratedTerminalï¼Œé‚£å°±ä¼šè¾“å‡ºåœ¨ terminal äº†ï¼š

![image](https://github.com/user-attachments/assets/834b84d5-1542-470d-a518-d693231fdc28)

## è°ƒè¯•ç§»åŠ¨ç«¯ç½‘é¡µ

å®‰å“è°ƒè¯•ï¼š[https://juejin.cn/book/7070324244772716556/section/7071922622262411296](https://juejin.cn/book/7070324244772716556/section/7071922622262411296)

IOSè°ƒè¯•ï¼šios ç½‘é¡µè°ƒè¯•åªèƒ½ç”¨ safari æµè§ˆå™¨ï¼Œä¹Ÿå°±æ˜¯ä½ å¿…é¡»ä½¿ç”¨MacOSç³»ç»Ÿã€‚

## Charleså·¥å…·ä½¿ç”¨

### è°ƒè¯•httpsè¯·æ±‚

- æ·»åŠ Clarlesè‡ªå·±çš„è¯ä¹¦ï¼Œå¯ä»¥çœ‹åˆ°æ˜æ–‡çš„ https è¯·æ±‚å’Œå“åº”å†…å®¹
- å¦‚æœæƒ³ä¿®æ”¹ä¸€ä¸‹è¯·æ±‚å’Œå“åº”å†…å®¹çš„ï¼Œè¿™æ—¶å€™å°±è¦ç”¨urlæ–­ç‚¹åŠŸèƒ½

**ç§»åŠ¨ç«¯æ€ä¹ˆè°ƒè¯•ï¼Ÿ**

å…¶å®æ˜¯ä¸€æ ·çš„ï¼Œåªä¸è¿‡ç§»åŠ¨ç«¯ä¹Ÿè¦æŠŠ Charles è¯ä¹¦å®‰è£…åˆ°è‡ªå·±çš„ç³»ç»Ÿä¸­ï¼Œéœ€è¦ç‚¹å‡»å®‰è£… charles è¯ä¹¦åˆ°ç§»åŠ¨è®¾å¤‡ã€‚

chrome è¿˜æœ‰ä¸€ä¸ªæµè§ˆå™¨æ’ä»¶å¯ä»¥æ›´ç»†ç²’åº¦çš„æ§åˆ¶ä»£ç†ï¼Œå«åš SwitchyOmegaã€‚å¯ä»¥é…ç½®è‹¥å¹²ä¸ªä»£ç†æœåŠ¡å™¨ï¼Œæ¯”å¦‚ charles çš„ä»£ç†æœåŠ¡å™¨ã€‚

è¦è®©ä½ é…ç½®çš„è§„åˆ™ç”Ÿæ•ˆï¼Œè¿™é‡Œè¦é€‰æ‹© auto switchï¼Œä¹Ÿå°±æ˜¯æ ¹æ®è§„åˆ™è‡ªåŠ¨åˆ‡æ¢ã€‚

å½“ä½ æœ‰å¤šä¸ªä»£ç†æœåŠ¡å™¨ï¼Œæˆ–è€…æƒ³æ§åˆ¶æœ‰çš„é¡µé¢èµ°ä»£ç†æœ‰çš„ä¸èµ°çš„æ—¶å€™ï¼Œå°±å¯ä»¥ç”¨è¿™ä¸ªæ’ä»¶æ¥æ§åˆ¶äº†ã€‚

### Charleså…¨åŠŸèƒ½ç®€ä»‹

- no cachingï¼š ç¦ç”¨ç¼“å­˜
- block cookiesï¼šç¦ç”¨ cookie
- map remoteï¼šè½¬å‘è¯·æ±‚åˆ°å¦ä¸€ä¸ª url
- map localï¼šç”¨æœ¬åœ°çš„æ–‡ä»¶ä½œä¸ºè¯¥è¯·æ±‚çš„å“åº”å†…å®¹
- mirrorï¼šæŠŠå“åº”ä¿å­˜åœ¨æœ¬åœ°æ–‡ä»¶
- rewriteï¼š é‡å†™è¯·æ±‚æˆ–å“åº”çš„å„ç§æ•°æ®
- block listï¼šç¦æ­¢ä¸€äº› url çš„è¯·æ±‚
- allow listï¼šåªå…è®¸ä¸€äº› url çš„è¯·æ±‚
- SSL Proxyingï¼šä»£ç† https è¯·æ±‚ï¼Œç”¨ charles è‡ªå·±çš„è¯ä¹¦ï¼Œéœ€è¦å®‰è£… charles è¯ä¹¦åˆ°ç³»ç»Ÿå¹¶ä¿¡ä»»
- breakpointsï¼šæ–­ç‚¹ä¿®æ”¹è¯·æ±‚/å“åº”

- DNS Spoofingï¼šDNS æ¬ºéª—ï¼Œç±»ä¼¼ hostsï¼Œä½†æ˜¯åªå½±å“ http å’Œ https
- Client Processï¼šå±•ç¤ºå‘è¯·æ±‚çš„è¿›ç¨‹å
- Composeï¼šcompose new åˆ›å»ºä¸€ä¸ªæ–°çš„è¯·æ±‚ï¼Œcompose ä¿®æ”¹å·²æœ‰çš„è¯·æ±‚
- Repeatï¼šé‡å‘è¯·æ±‚ï¼Œå¯ä»¥è®¾ç½®é‡å‘æ¬¡æ•°ã€å¹¶å‘æ•°ã€é‡å‘é—´éš”
- Throttleï¼šæ¨¡æ‹Ÿæ…¢é€Ÿè¯·æ±‚ï¼Œå¯ä»¥åšå…·ä½“çš„é€Ÿç‡è®¾ç½®
- Focusï¼šåªå±•ç¤ºå…³æ³¨çš„ hosts çš„è¯·æ±‚ï¼Œå…¶ä½™çš„æŠ˜å 
- Highlight Rulesï¼šæ ¹æ®è§„åˆ™æ¥é«˜äº®è¯·æ±‚ï¼Œä½¿ç”¨ä¸åŒçš„é¢œè‰²
- Web Interfaceï¼šé€šè¿‡ web ç•Œé¢æ¥æ§åˆ¶ä¸€äº›åŠŸèƒ½çš„å¼€å¯å…³é—­ï¼Œè¿™é€‚ç”¨äºè¿œç¨‹æ§åˆ¶
- Findï¼šåœ¨ sessionã€path ç­‰èŒƒå›´å†…æ ¹æ®å…³é”®è¯æœç´¢
- External Proxyï¼šcharles å¯ä»¥æŠŠè¯·æ±‚è½¬å‘ç»™åˆ«çš„ä»£ç†æœåŠ¡å™¨ï¼Œæ¯”å¦‚ç§‘å­¦ä¸Šç½‘çš„

### å¦‚ä½•ä¼˜é›…çš„è°ƒè¯•çº¿ä¸ŠæŠ¥é”™ï¼Ÿ

1. é¦–å…ˆåˆ›å»ºä¸€ä¸ª vscode è°ƒè¯•é…ç½®ï¼Œurlå¯¹åº”çº¿ä¸Šåœ°å€
2. éœ€è¦é…ç½® "userDataDir": "/users/daotin/mydatadir", åˆ°æŸä¸ªè·¯å¾„
3. å‹¾é€‰ uncaught exceptionsï¼Œåœ¨æœªè¢«æ•è·çš„å¼‚å¸¸å¤„æ–­ä½
4. ç„¶åå¯åŠ¨è°ƒè¯•ï¼Œå°±ä¼šå‘ç°åœ¨æœªè¢«æ•è·çš„å¼‚å¸¸å¤„æ–­ä½ï¼Œä½†æ˜¯å‘ç°ä»£ç æ˜¯è¢«å‹ç¼©è¿‡çš„ã€‚
5. ç¼–è¯‘é¡¹ç›®æºç ç”Ÿæˆsource-mapï¼ˆwebpack çš„ devtool ä¸º hidden-source-mapï¼Œç”Ÿæˆ sourcemap ä½†æ˜¯ä¸å…³è”ï¼‰
6. å®‰è£…chromeæ’ä»¶ SwitchyOmega
7. é…ç½®proxyåœ°å€å’Œç«¯å£ï¼ˆ127.0.0.1:8888ï¼‰
8. é…ç½®auto switchï¼Œè®©çº¿ä¸Šåœ°å€èµ°proxyä»£ç†ï¼Œä¹‹åç‚¹å‡»åº”ç”¨é€‰é¡¹
9. æœ€åï¼Œä»£ç†æ–¹å¼è®¾ç½®æˆ auto switch
10. charlesè®¾ç½®æ–­ç‚¹ï¼šç‚¹å‡» Proxy > Breakpoint Settingsï¼Œæ·»åŠ ä¸€ä¸ªå¯¹çº¿ä¸Šåœ°å€çš„ xxx.js å“åº”çš„æ–­ç‚¹ï¼Œå¼ºåˆ¶åˆ·ä¸‹é¡µé¢ï¼Œcharles å°±ä¼šæ–­ä½
11. ç„¶åå¯ä»¥ä¿®æ”¹å“åº”çš„å†…å®¹ï¼ŒåŠ ä¸Šäº†è¿™æ ·ä¸€è¡Œ sourcemap çš„å…³è”ï¼š`//# sourceMappingURL=http://www.guangtest.com:8084/dist/index.js.map`
12. ç„¶åç‚¹å‡» execute æ¥æ‰§è¡Œä¿®æ”¹ï¼Œå¼‚å¸¸æ–­ç‚¹ç°åœ¨ç›´æ¥åœ¨æºç å¤„æ–­ä½äº†ã€‚æ¥ä¸‹æ¥å°±å¯ä»¥ç›´æ¥è°ƒè¯•æºç äº†ï¼Œå¯ä»¥é€šè¿‡ä½œç”¨åŸŸã€è°ƒç”¨æ ˆç­‰ä¿¡æ¯æ¥å®šä½æŠ¥é”™åŸå› 

å‚è€ƒï¼š[https://juejin.cn/book/7070324244772716556/section/7156796826728071200](https://juejin.cn/book/7070324244772716556/section/7156796826728071200)

æ³¨æ„ï¼šcharles æ–­ç‚¹ä¿®æ”¹çš„å†…å®¹ä¼šç¼“å­˜ï¼ˆæ¯”å¦‚æ·»åŠ çš„mapæ–‡ä»¶ï¼‰ï¼Œå¼ºåˆ¶åˆ·æ–°ï¼ˆctrl+shift+Rï¼‰æ‰ä¼šé‡æ–°è¯·æ±‚ã€‚
