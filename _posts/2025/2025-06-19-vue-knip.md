---
layout: mypost
title: Vue + TypeScript é¡¹ç›®æ­»ä»£ç æ£€æµ‹æœ€ä½³æ–¹æ¡ˆ
tags: [vue]
---

1. ç›®å½•
{:toc}

## ğŸ“– æ¦‚è¿°

æœ€è¿‘æ¥æ‰‹äº†ä¸€ä¸ªé™ˆå¹´è€æ—§é¡¹ç›®ï¼Œä»£ç åº“ä¸­ç§¯ç´¯äº†å¤§é‡çš„å­¤å„¿å‡½æ•°ã€æœªä½¿ç”¨çš„æ–‡ä»¶å’Œæ¨¡å—ã€‚æœ¬æ–‡æ¡£æä¾›äº†ä¸€å¥—å®Œæ•´çš„æ­»ä»£ç æ£€æµ‹å’Œæ¸…ç†æ–¹æ¡ˆï¼Œå¸®åŠ©å›¢é˜Ÿç»´æŠ¤é«˜è´¨é‡çš„ä»£ç åº“ã€‚

## ğŸ¯ æ£€æµ‹ç›®æ ‡

- âœ… æœªä½¿ç”¨çš„æ–‡ä»¶å’Œç»„ä»¶
- âœ… æœªä½¿ç”¨çš„ä¾èµ–åŒ…ï¼ˆdependencies & devDependenciesï¼‰
- âœ… æœªåˆ—å‡ºçš„ä¾èµ–ï¼ˆmissing dependenciesï¼‰
- âœ… æœªä½¿ç”¨çš„å¯¼å‡ºå‡½æ•°ã€ç±»å‹ã€æ¥å£
- âœ… é‡å¤çš„å¯¼å‡ºå’Œå‡½æ•°
- âœ… æœªä½¿ç”¨çš„ç±»æˆå‘˜å’Œæšä¸¾æˆå‘˜
- âœ… æ— æ³•è§£æçš„ import è·¯å¾„

## ğŸ› ï¸ æ¨èå·¥å…·

### ä¸»è¦å·¥å…·ï¼šKnipï¼ˆé¦–é€‰ï¼‰

**ä¸ºä»€ä¹ˆé€‰æ‹© Knipï¼Ÿ**

- ğŸ”¥ æ´»è·ƒç»´æŠ¤ï¼ŒåŠŸèƒ½æœ€å…¨é¢
- ğŸ¯ æ”¯æŒ Vue 3 + TypeScript é¡¹ç›®
- ğŸ”Œ å†…ç½® 65+æ’ä»¶ï¼Œè‡ªåŠ¨è¯†åˆ«ä¸»æµæ¡†æ¶
- ğŸ“Š æä¾›å¤šç§æŠ¥å‘Šæ ¼å¼
- ğŸš€ æ”¯æŒ monorepo å’Œå·¥ä½œåŒº
- âš¡ æ€§èƒ½ä¼˜ç§€ï¼Œæ”¯æŒå¤§å‹é¡¹ç›®

**å¯¹æ¯”å…¶ä»–å·¥å…·ï¼š**

| åŠŸèƒ½ | Knip | depcheck | ts-unused-exports | ESLint |
|------|------|----------|-------------------|--------|
| æœªä½¿ç”¨æ–‡ä»¶ | âœ… | âŒ | âŒ | âŒ |
| æœªä½¿ç”¨ä¾èµ– | âœ… | âœ… | âŒ | âŒ |
| æœªä½¿ç”¨å¯¼å‡º | âœ… | âŒ | âœ… | éƒ¨åˆ† |
| Vue æ”¯æŒ | âœ… | éƒ¨åˆ† | âŒ | âœ… |
| TypeScript æ”¯æŒ | âœ… | éƒ¨åˆ† | âœ… | âœ… |
| ç»´æŠ¤çŠ¶æ€ | æ´»è·ƒ | åœæ­¢ç»´æŠ¤ | ç»´æŠ¤ä¸­ | æ´»è·ƒ |

## ğŸ“¦ å®‰è£…å’Œé…ç½®

### 1. å®‰è£… Knip

```bash
# ä½¿ç”¨npm
npm install -D knip

# ä½¿ç”¨yarn
yarn add -D knip

# ä½¿ç”¨pnpm
pnpm add -D knip
```

### 2. åˆ›å»ºé…ç½®æ–‡ä»¶

åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º `knip.json`ï¼š

```json
{
	"$schema": "https://unpkg.com/knip@latest/schema.json",
	"entry": ["src/main.ts", "src/router/index.ts", "src/store/index.ts"],
	"project": ["src/**/*.{vue,ts,js,jsx,tsx}"],
	"ignore": ["**/*.d.ts", "**/dist/**", "**/node_modules/**", "**/.nuxt/**", "**/coverage/**", "**/public/**"],
	"ignoreDependencies": ["@types/*", "typescript"],
}
```

### 3. é«˜çº§é…ç½®é€‰é¡¹

```json
{
	"$schema": "https://unpkg.com/knip@latest/schema.json",
	"entry": ["src/main.ts"],
	"project": ["src/**/*.{vue,ts,js}"],

	// ç”Ÿäº§æ¨¡å¼é…ç½®
	"production": {
		"entry": ["src/main.ts!"],
		"project": ["src/**/*.{vue,ts,js}!"]
	},

	// å¿½ç•¥ç‰¹å®šç±»å‹çš„é—®é¢˜
	"rules": {
		"files": "warn", // æ–‡ä»¶é—®é¢˜æ˜¾ç¤ºä¸ºè­¦å‘Š
		"dependencies": "error", // ä¾èµ–é—®é¢˜æ˜¾ç¤ºä¸ºé”™è¯¯
		"exports": "error", // å¯¼å‡ºé—®é¢˜æ˜¾ç¤ºä¸ºé”™è¯¯
		"types": "warn", // ç±»å‹é—®é¢˜æ˜¾ç¤ºä¸ºè­¦å‘Š
		"enumMembers": "off" // å…³é—­æšä¸¾æˆå‘˜æ£€æµ‹
	},

	// å¿½ç•¥åœ¨æ–‡ä»¶å†…éƒ¨ä½¿ç”¨çš„å¯¼å‡º
	"ignoreExportsUsedInFile": true,

	// è·¯å¾„åˆ«åé…ç½®
	"paths": {
		"@/*": ["./src/*"],
		"@components/*": ["./src/components/*"],
		"@utils/*": ["./src/utils/*"]
	},

	// å·¥ä½œåŒºé…ç½®ï¼ˆé€‚ç”¨äºmonorepoï¼‰
	"workspaces": {
		".": {
			"entry": ["src/main.ts"],
			"project": ["src/**/*.{vue,ts,js}"]
		},
		"packages/*": {
			"entry": ["src/index.ts"],
			"project": ["src/**/*.ts"]
		}
	}
}
```

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### åŸºç¡€å‘½ä»¤

```bash
# è¿è¡Œå®Œæ•´æ£€æµ‹
npx knip

# ä»…æ£€æµ‹ä¾èµ–é—®é¢˜
npx knip --dependencies

# ä»…æ£€æµ‹å¯¼å‡ºé—®é¢˜
npx knip --exports

# ç”Ÿäº§æ¨¡å¼æ£€æµ‹
npx knip --production

# ä¸¥æ ¼æ¨¡å¼ï¼ˆä»…æ£€æŸ¥ç›´æ¥ä¾èµ–ï¼‰
npx knip --strict

# æŒ‡å®šæŠ¥å‘Šæ ¼å¼
npx knip --reporter json
npx knip --reporter compact
npx knip --reporter codeowners
```

### é«˜çº§ç”¨æ³•

```bash
# æ£€æµ‹å•ä¸ªå·¥ä½œåŒº
npx knip --workspace packages/ui

# åŒ…å«å…¥å£æ–‡ä»¶çš„å¯¼å‡ºæ£€æµ‹
npx knip --include-entry-exports

# æ’é™¤ç‰¹å®šé—®é¢˜ç±»å‹
npx knip --exclude files,dependencies

# è°ƒè¯•æ¨¡å¼
npx knip --debug

# æ€§èƒ½åˆ†æ
npx knip --performance
```

## ğŸ“Š æŠ¥å‘Šè§£è¯»

### é—®é¢˜ç±»å‹è¯´æ˜

| é—®é¢˜ç±»å‹          | æè¿°             | å»ºè®®å¤„ç†             |
| ----------------- | ---------------- | -------------------- |
| `files`           | æœªè¢«å¼•ç”¨çš„æ–‡ä»¶   | åˆ é™¤æˆ–ç¡®è®¤æ˜¯å¦éœ€è¦   |
| `dependencies`    | æœªä½¿ç”¨çš„ä¾èµ–     | ä» package.json ç§»é™¤ |
| `devDependencies` | æœªä½¿ç”¨çš„å¼€å‘ä¾èµ– | ä» package.json ç§»é™¤ |
| `unlisted`        | ç¼ºå¤±çš„ä¾èµ–       | æ·»åŠ åˆ° package.json  |
| `unresolved`      | æ— æ³•è§£æçš„å¯¼å…¥   | æ£€æŸ¥è·¯å¾„æˆ–å®‰è£…ä¾èµ–   |
| `exports`         | æœªä½¿ç”¨çš„å¯¼å‡º     | ç§»é™¤å¯¼å‡ºæˆ–ç¡®è®¤ç”¨é€”   |
| `types`           | æœªä½¿ç”¨çš„ç±»å‹å¯¼å‡º | ç§»é™¤å¯¼å‡ºæˆ–ç¡®è®¤ç”¨é€”   |
| `enumMembers`     | æœªä½¿ç”¨çš„æšä¸¾æˆå‘˜ | ç§»é™¤æˆ–æ ‡è®°@public    |
| `classMembers`    | æœªä½¿ç”¨çš„ç±»æˆå‘˜   | ç§»é™¤æˆ–æ ‡è®°@public    |
| `duplicates`      | é‡å¤å¯¼å‡º         | ä¿ç•™ä¸€ä¸ªå¯¼å‡ºä½ç½®     |

### ç¤ºä¾‹æŠ¥å‘Š

```
âœ‚ï¸ Knip found issues in 1 workspace:

Unused files (2)
  src/components/UnusedComponent.vue
  src/utils/oldHelper.ts

Unused dependencies (3)
  lodash
  moment
  @types/lodash

Unlisted dependencies (1)
  dayjs  src/utils/dateHelper.ts:1:0

Unused exports (4)
  calculateTotal  src/utils/math.ts:15:0
  UserInterface   src/types/user.ts:8:0
  formatDate      src/utils/date.ts:23:0
  API_ENDPOINT    src/config/constants.ts:5:0
```

## ğŸ›¡ï¸ JSDoc æ ‡è®°

ä½¿ç”¨ JSDoc æ ‡è®°æ¥æ§åˆ¶æ£€æµ‹è¡Œä¸ºï¼š

```typescript
/**
 * å…¬å…±APIï¼Œä¸è¦æŠ¥å‘Šä¸ºæœªä½¿ç”¨
 * @public
 */
export const publicApi = () => {}

/**
 * å†…éƒ¨ä½¿ç”¨ï¼Œç”Ÿäº§æ¨¡å¼ä¸‹å¿½ç•¥
 * @internal
 */
export const internalHelper = () => {}

/**
 * åˆ«åå¯¼å‡ºï¼Œä¸æŠ¥å‘Šé‡å¤
 * @alias
 */
export { default as Component } from './Component.vue'

/**
 * BetaåŠŸèƒ½
 * @beta
 */
export const betaFeature = () => {}
```

## ğŸ”„ CI/CD é›†æˆ

### 1. æ·»åŠ  npm è„šæœ¬

```json
{
	"scripts": {
		"lint:dead-code": "knip",
		"lint:dead-code:ci": "knip --reporter json",
		"lint:dead-code:production": "knip --production",
		"check:unused": "knip --dependencies"
	}
}
```

### 2. GitHub Actions é…ç½®

```yaml
name: Dead Code Detection
on:
  pull_request:
    branches: [main, develop]

jobs:
  detect-dead-code:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      - name: Run dead code detection
        run: npm run lint:dead-code:ci
```

### 3. é¢„æäº¤é’©å­

```bash
# å®‰è£…huskyå’Œlint-staged
npm install -D husky lint-staged

# é…ç½®package.json
{
  "lint-staged": {
    "src/**/*.{vue,ts,js}": [
      "knip --include exports,dependencies"
    ]
  }
}
```

## ğŸ“ é¡¹ç›®ç»“æ„å»ºè®®

### æ¨èçš„ç›®å½•ç»“æ„

```
src/
â”œâ”€â”€ main.ts                 # å…¥å£æ–‡ä»¶
â”œâ”€â”€ App.vue                 # æ ¹ç»„ä»¶
â”œâ”€â”€ components/             # å…¬å…±ç»„ä»¶
â”‚   â”œâ”€â”€ common/            # é€šç”¨ç»„ä»¶
â”‚   â””â”€â”€ business/          # ä¸šåŠ¡ç»„ä»¶
â”œâ”€â”€ views/                 # é¡µé¢ç»„ä»¶
â”œâ”€â”€ router/                # è·¯ç”±é…ç½®
â”œâ”€â”€ store/                 # çŠ¶æ€ç®¡ç†
â”œâ”€â”€ composables/           # ç»„åˆå¼å‡½æ•°
â”œâ”€â”€ utils/                 # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ index.ts          # ç»Ÿä¸€å¯¼å‡º
â”‚   â”œâ”€â”€ http.ts           # HTTPç›¸å…³
â”‚   â”œâ”€â”€ format.ts         # æ ¼å¼åŒ–å‡½æ•°
â”‚   â””â”€â”€ validation.ts     # éªŒè¯å‡½æ•°
â”œâ”€â”€ types/                 # ç±»å‹å®šä¹‰
â”œâ”€â”€ assets/               # é™æ€èµ„æº
â””â”€â”€ styles/               # æ ·å¼æ–‡ä»¶
```

### æ¨¡å—å¯¼å‡ºå»ºè®®

```typescript
// utils/index.ts - ç»Ÿä¸€å¯¼å‡ºå…¥å£
export * from './http'
export * from './format'
export * from './validation'

// é¿å…ç›´æ¥å¯¼å‡º
export { default as HttpClient } from './http'
```

## ğŸ”§ å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ

### 1. Vue ç»„ä»¶æœªè¢«æ£€æµ‹åˆ°

**åŸå› **ï¼šKnip å¯èƒ½æ— æ³•è¯†åˆ« Vue ç»„ä»¶çš„åŠ¨æ€å¼•ç”¨

**è§£å†³æ–¹æ¡ˆ**ï¼š

```json
{
	"vue": {
		"entry": ["src/**/*.vue", "src/components/**/*.vue"]
	}
}
```

### 2. è·¯å¾„åˆ«åæ— æ³•è§£æ

**è§£å†³æ–¹æ¡ˆ**ï¼š

```json
{
	"paths": {
		"@/*": ["./src/*"],
		"~/": ["./"]
	}
}
```

### 3. ç¬¬ä¸‰æ–¹åº“è¯¯æŠ¥

**è§£å†³æ–¹æ¡ˆ**ï¼š

```json
{
	"ignoreDependencies": ["vue-demi", "@vueuse/core"]
}
```

### 4. åŠ¨æ€å¯¼å…¥è¢«è¯¯æŠ¥

**è§£å†³æ–¹æ¡ˆ**ï¼š

```typescript
// ä½¿ç”¨æ³¨é‡Šæ ‡è®°
/* @public */
export const dynamicComponent = () => import('./Component.vue')
```

## ğŸ“ˆ æœ€ä½³å®è·µ

### 1. æ¸è¿›å¼æ¸…ç†

```bash
# ç¬¬ä¸€æ­¥ï¼šä»…æ£€æŸ¥æ˜æ˜¾é—®é¢˜
npx knip --include files,dependencies

# ç¬¬äºŒæ­¥ï¼šæ£€æŸ¥å¯¼å‡ºé—®é¢˜
npx knip --include exports,types

# ç¬¬ä¸‰æ­¥ï¼šå…¨é¢æ£€æŸ¥
npx knip
```

### 2. å›¢é˜Ÿåä½œè§„èŒƒ

- ğŸ¯ æ¯ä¸ª PR è¿è¡Œæ­»ä»£ç æ£€æµ‹
- ğŸ“Š å®šæœŸç”Ÿæˆæ£€æµ‹æŠ¥å‘Š
- ğŸ”„ å»ºç«‹æ¸…ç†è®¡åˆ’å’Œæ—¶é—´è¡¨
- ğŸ“ æ–‡æ¡£åŒ–ç‰¹æ®Šæƒ…å†µçš„å¤„ç†æ–¹å¼

### 3. æ€§èƒ½ä¼˜åŒ–

```bash
# å¤§å‹é¡¹ç›®æ€§èƒ½ä¼˜åŒ–
npx knip --no-gitignore           # å¿½ç•¥.gitignoreæå‡æ€§èƒ½
npx knip --workspace frontend     # å•ç‹¬æ£€æµ‹å·¥ä½œåŒº
```

### 4. ä»£ç ç»„ç»‡å»ºè®®

```typescript
// âœ… æ¨èï¼šæ˜ç¡®çš„å¯¼å‡º
export interface User {
	id: string
	name: string
}

export function createUser(data: Partial<User>): User {
	// implementation
}

// âŒ é¿å…ï¼šæ‰¹é‡å¯¼å‡ºæœªä½¿ç”¨çš„å†…å®¹
export * from './helpers'
```

## ğŸ”® é«˜çº§é…ç½®

### è‡ªå®šä¹‰æŠ¥å‘Šå™¨

```typescript
// custom-reporter.js
module.exports = report => {
	const issues = Object.values(report).flat()
	console.log(`å‘ç° ${issues.length} ä¸ªé—®é¢˜`)

	// è‡ªå®šä¹‰è¾“å‡ºæ ¼å¼
	issues.forEach(issue => {
		console.log(`${issue.file}:${issue.line} - ${issue.name}`)
	})
}
```

### é¢„å¤„ç†å™¨

```typescript
// preprocessor.js
module.exports = report => {
	// è¿‡æ»¤æ‰æµ‹è¯•æ–‡ä»¶çš„é—®é¢˜
	Object.keys(report).forEach(key => {
		report[key] = report[key].filter(issue => !issue.file.includes('.spec.') && !issue.file.includes('.test.'))
	})
	return report
}
```

## ğŸ“š å‚è€ƒèµ„æº

- [Knip å®˜æ–¹æ–‡æ¡£](https://knip.dev/)
- [Vue 3 å®˜æ–¹æ–‡æ¡£](https://vuejs.org/)
- [TypeScript å®˜æ–¹æ–‡æ¡£](https://www.typescriptlang.org/)
- [ESLint Vue æ’ä»¶](https://eslint.vuejs.org/)
